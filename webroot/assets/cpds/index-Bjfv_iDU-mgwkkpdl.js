import"../modulepreload-polyfill-B5Qt9EMX-mgwkkpee.js";/* empty css                         */import"../htmx.esm-hCWdS4WT-mgwkkpef.js";import{s as i,l as o,h as c,c as s}from"../shared-DruKi8Dd-mgwkkped.js";async function a(){const e=await fetch("/ids/auth/refresh",{method:"POST",credentials:"include"});if(e.ok){const{access_token:t,refresh_token:n}=await e.json();return window.localStorage.setItem("access_token",t),window.localStorage.setItem("refresh_token",n),window.localStorage.setItem("is_authenticated","true"),!0}else return window.localStorage.removeItem("access_token"),window.localStorage.removeItem("refresh_token"),window.localStorage.setItem("is_authenticated","false"),!1}window.onload=async()=>{i();let e=!1;try{if(!await a()){o("out","State: not authenticated, please login"),document.getElementById("login").classList.remove("hidden"),window.location.hash.includes("switcher")?location.href="/ids/auth/login":e=!0;return}o("out","Authenticated."),document.getElementById("logout").classList.remove("hidden"),document.getElementById("userinfo").classList.remove("hidden"),document.getElementById("callapi").classList.remove("hidden");var t=setInterval(async()=>{if(!await a()){o("out","State: not authenticated, clearing interval"),clearInterval(t),document.getElementById("logout").classList.add("hidden"),document.getElementById("userinfo").classList.add("hidden"),document.getElementById("callapi").classList.add("hidden"),document.getElementById("login").classList.remove("hidden");return}},6e4);e=!0}catch(n){o("out","Init error: "+n)}finally{e&&c()}};document.getElementById("login").onclick=()=>{i(),location.href="/ids/auth/login"};document.getElementById("logout").onclick=()=>{i(),location.href="/ids/auth/logout"};document.getElementById("userinfo").onclick=async()=>{if(!(window.localStorage.getItem("is_authenticated")==="true"&&window.localStorage.getItem("access_token")))return o("out","Not logged in");const t=await fetch("/ids/me",{credentials:"include",headers:{Authorization:"Bearer "+window.localStorage.getItem("access_token")}});o("out","userinfo: "+JSON.stringify(await t.json(),null,2))};document.getElementById("callapi").onclick=async()=>{if(!(window.localStorage.getItem("is_authenticated")==="true"&&window.localStorage.getItem("access_token")))return o("out","Not logged in");const t=await s("/cpds/api/hello",window.localStorage.getItem("access_token"));o("out",`CPDS API [${t.status}]:
${t.body}`)};document.getElementById("switch").onclick=()=>{window.location.href="/aceas/#switcher"};document.getElementById("clear-console")?.addEventListener("click",()=>{const e=document.getElementById("out");e&&(e.textContent=`Console cleared.
Waiting for user interaction...`)});
//# sourceMappingURL=index-Bjfv_iDU-mgwkkpdl.js.map
