import"../modulepreload-polyfill-B5Qt9EMX-mgwkkpee.js";/* empty css                         */import"../htmx.esm-hCWdS4WT-mgwkkpef.js";import{E as y,d as f}from"../vendor-signals-CeVd-X9L-mgwkkpdm.js";import{l as n,s as S,c as v,h as k}from"../shared-DruKi8Dd-mgwkkped.js";import{o as s}from"../oidc-CttL1XcN-mgwkkpeh.js";import"../vendor-oidc-C7bVSgrn-mgwkkpdz.js";const m=document.getElementById("login"),l=document.getElementById("logout"),u=document.getElementById("userinfo"),d=document.getElementById("callapi"),A=document.getElementById("switch"),c=document.getElementById("auth-status"),p=document.getElementById("clear-console"),i={isAuthenticated:f(!1),isLoading:f(!1),userInfo:f(null)};function r(e,t="info"){const g=`${`[${new Date().toLocaleTimeString()}] [${t.toUpperCase()}]`} ${e}`;n("out",g)}function L(){const e=document.getElementById("out");e&&(e.textContent=`Console cleared.
Waiting for user interaction...`)}function h(e,t=null){if(!c)return;const o=c.querySelector("div"),a=c.querySelector("span");e?(c.className="status-indicator status-online",o&&(o.className="w-2 h-2 bg-green-500 rounded-full animate-pulse"),a&&(a.textContent=t?`${t.preferred_username||"User"}`:"Authenticated")):(c.className="status-indicator status-offline",o&&(o.className="w-2 h-2 bg-red-500 rounded-full"),a&&(a.textContent="Not Authenticated"))}function w(e){const o=document.getElementById("loading-overlay")?.querySelector(".loading-message");o&&(o.textContent=e),S()}async function B(){r("Checking SSO status...","info"),w("Checking local cache...");try{const e=await s.getUser();if(e&&!e.expired)return r("Using cached user session","success"),h(!0,e.profile),!0;w("Checking SSO session...");const t=await s.signinSilent();if(t&&!t.expired)return r("Silent signin successful - SSO session active","success"),h(!0,t.profile),!0}catch(e){r(`SSO check failed: ${e.message}`,"warn")}return r("No active SSO session found","info"),h(!1),!1}async function x(){i.isLoading.value=!0;try{m.onclick=()=>s.signinRedirect(),A.onclick=()=>{const t=encodeURIComponent("/cpds/");window.location.href="/cpds/#switcher"};const e=await B();if(i.isAuthenticated.value=e,e)n("out","Authenticated.");else if(n("out","Not authenticated."),window.location.hash.includes("switcher")){await s.signinRedirect();return}s.events.addAccessTokenExpiring(async()=>{try{await s.signinSilent(),n("out","token expiring → silent renew"),n("out","silent renew success")}catch(t){n("out","silent renew error: "+t)}}),s.events.addAccessTokenExpired(async()=>{try{await s.signinSilent(),n("out","token expired → silent renew")}catch(t){n("out","silent renew error: "+t),i.isAuthenticated.value=!1}}),s.events.addUserSignedOut(async()=>{await s.removeUser(),i.isAuthenticated.value=!1})}catch(e){n("out","Init error: "+e),i.isAuthenticated.value=!1}finally{i.isLoading.value=!1}}y(()=>{const e=i.isAuthenticated.value;e?(m.classList.add("hidden"),l.classList.remove("hidden"),u.classList.remove("hidden"),d.classList.remove("hidden")):(m.classList.remove("hidden"),l.classList.add("hidden"),u.classList.add("hidden"),d.classList.add("hidden")),e&&(l.onclick||(l.onclick=async()=>{try{await s.signoutRedirect({post_logout_redirect_uri:`${window.location.origin}/aceas/`})}finally{await s.removeUser(),i.isAuthenticated.value=!1}}),u.onclick||(u.onclick=async()=>{const t=await s.getUser();if(!t)return n("out","Not logged in!");const a=await(await fetch("http://eservice.localhost/auth/realms/agency-realm/protocol/openid-connect/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}})).json();i.userInfo.value=a,n("out","userinfo: "+JSON.stringify(a,null,2));const g=await fetch("http://eservice.localhost/auth/realms/agency-realm/demo/ping",{headers:{Authorization:`Bearer ${t.access_token}`}});n("out","ping: "+JSON.stringify(await g.json(),null,2))}),d.onclick||(d.onclick=async()=>{const t=await s.getUser();if(!t)return n("out","Login first");const o=await v("/aceas/api/hello",t.access_token);n("out",`ACEAS API [${o.status}]:
${o.body}`)}))});y(()=>i.isLoading.value?S():k());p&&p.addEventListener("click",L);x();
//# sourceMappingURL=index-Du63XuXa-mgwkkpdm.js.map
