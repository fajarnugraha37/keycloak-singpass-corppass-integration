import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{l as v,c as hi,s as vi,h as di}from"../sched-DruKi8Dd.js";import{o as d}from"../oidc-DAcC_2S7.js";var b,X;function pi(t){return t.children}b={__e:function(t,i,e,n){for(var o,r,s;i=i.__;)if((o=i.__c)&&!o.__)try{if((r=o.constructor)&&r.getDerivedStateFromError!=null&&(o.setState(r.getDerivedStateFromError(t)),s=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(t,n||{}),s=o.__d),s)return o.__E=o}catch(c){t=c}throw t}},X=function(t){return t!=null&&t.constructor==null},typeof Promise=="function"&&Promise.prototype.then.bind(Promise.resolve());var T,f,H,q,R=0,Y=[],_=b,j=_.__b,W=_.__r,J=_.diffed,Z=_.__c,z=_.unmount,M=_.__;function ii(t,i){_.__h&&_.__h(f,t,R||i),R=0;var e=f.__H||(f.__H={__:[],__h:[]});return t>=e.__.length&&e.__.push({}),e.__[t]}function yi(t){return R=1,gi(ti,t)}function gi(t,i,e){var n=ii(T++,2);if(n.t=t,!n.__c&&(n.__=[ti(void 0,i),function(c){var a=n.__N?n.__N[0]:n.__[0],l=n.t(a,c);a!==l&&(n.__N=[l,n.__[1]],n.__c.setState({}))}],n.__c=f,!f.__f)){var o=function(c,a,l){if(!n.__c.__H)return!0;var y=n.__c.__H.__.filter(function(p){return!!p.__c});if(y.every(function(p){return!p.__N}))return!r||r.call(this,c,a,l);var O=n.__c.props!==c;return y.forEach(function(p){if(p.__N){var m=p.__[0];p.__=p.__N,p.__N=void 0,m!==p.__[0]&&(O=!0)}}),r&&r.call(this,c,a,l)||O};f.__f=!0;var r=f.shouldComponentUpdate,s=f.componentWillUpdate;f.componentWillUpdate=function(c,a,l){if(this.__e){var y=r;r=void 0,o(c,a,l),r=y}s&&s.call(this,c,a,l)},f.shouldComponentUpdate=o}return n.__N||n.__}function wi(t,i){var e=ii(T++,7);return Ai(e.__H,i)&&(e.__=t(),e.__H=i,e.__h=t),e.__}function mi(){for(var t;t=Y.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(x),t.__H.__h.forEach(F),t.__H.__h=[]}catch(i){t.__H.__h=[],_.__e(i,t.__v)}}_.__b=function(t){f=null,j&&j(t)},_.__=function(t,i){t&&i.__k&&i.__k.__m&&(t.__m=i.__k.__m),M&&M(t,i)},_.__r=function(t){W&&W(t),T=0;var i=(f=t.__c).__H;i&&(H===f?(i.__h=[],f.__h=[],i.__.forEach(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(i.__h.forEach(x),i.__h.forEach(F),i.__h=[],T=0)),H=f},_.diffed=function(t){J&&J(t);var i=t.__c;i&&i.__H&&(i.__H.__h.length&&(Y.push(i)!==1&&q===_.requestAnimationFrame||((q=_.requestAnimationFrame)||Si)(mi)),i.__H.__.forEach(function(e){e.u&&(e.__H=e.u),e.u=void 0})),H=f=null},_.__c=function(t,i){i.some(function(e){try{e.__h.forEach(x),e.__h=e.__h.filter(function(n){return!n.__||F(n)})}catch(n){i.some(function(o){o.__h&&(o.__h=[])}),i=[],_.__e(n,e.__v)}}),Z&&Z(t,i)},_.unmount=function(t){z&&z(t);var i,e=t.__c;e&&e.__H&&(e.__H.__.forEach(function(n){try{x(n)}catch(o){i=o}}),e.__H=void 0,i&&_.__e(i,e.__v))};var K=typeof requestAnimationFrame=="function";function Si(t){var i,e=function(){clearTimeout(n),K&&cancelAnimationFrame(i),setTimeout(t)},n=setTimeout(e,35);K&&(i=requestAnimationFrame(e))}function x(t){var i=f,e=t.__c;typeof e=="function"&&(t.__c=void 0,e()),f=i}function F(t){var i=f;t.__c=t.__(),f=i}function Ai(t,i){return!t||t.length!==i.length||i.some(function(e,n){return e!==t[n]})}function ti(t,i){return typeof i=="function"?i(t):i}var Ei=Symbol.for("preact-signals");function L(){if(w>1)w--;else{for(var t,i=!1;k!==void 0;){var e=k;for(k=void 0,G++;e!==void 0;){var n=e.o;if(e.o=void 0,e.f&=-3,!(8&e.f)&&oi(e))try{e.c()}catch(o){i||(t=o,i=!0)}e=n}}if(G=0,w--,i)throw t}}function $i(t){if(w>0)return t();w++;try{return t()}finally{L()}}var u=void 0;function ei(t){var i=u;u=void 0;try{return t()}finally{u=i}}var k=void 0,w=0,G=0,C=0;function ni(t){if(u!==void 0){var i=t.n;if(i===void 0||i.t!==u)return i={i:0,S:t,p:u.s,n:void 0,t:u,e:void 0,x:void 0,r:i},u.s!==void 0&&(u.s.n=i),u.s=i,t.n=i,32&u.f&&t.S(i),i;if(i.i===-1)return i.i=0,i.n!==void 0&&(i.n.p=i.p,i.p!==void 0&&(i.p.n=i.n),i.p=u.s,i.n=void 0,u.s.n=i,u.s=i),i}}function h(t,i){this.v=t,this.i=0,this.n=void 0,this.t=void 0,this.W=i?.watched,this.Z=i?.unwatched,this.name=i?.name}h.prototype.brand=Ei;h.prototype.h=function(){return!0};h.prototype.S=function(t){var i=this,e=this.t;e!==t&&t.e===void 0&&(t.x=e,this.t=t,e!==void 0?e.e=t:ei(function(){var n;(n=i.W)==null||n.call(i)}))};h.prototype.U=function(t){var i=this;if(this.t!==void 0){var e=t.e,n=t.x;e!==void 0&&(e.x=n,t.e=void 0),n!==void 0&&(n.e=e,t.x=void 0),t===this.t&&(this.t=n,n===void 0&&ei(function(){var o;(o=i.Z)==null||o.call(i)}))}};h.prototype.subscribe=function(t){var i=this;return A(function(){var e=i.value,n=u;u=void 0;try{t(e)}finally{u=n}},{name:"sub"})};h.prototype.valueOf=function(){return this.value};h.prototype.toString=function(){return this.value+""};h.prototype.toJSON=function(){return this.value};h.prototype.peek=function(){var t=u;u=void 0;try{return this.value}finally{u=t}};Object.defineProperty(h.prototype,"value",{get:function(){var t=ni(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){if(G>100)throw new Error("Cycle detected");this.v=t,this.i++,C++,w++;try{for(var i=this.t;i!==void 0;i=i.x)i.t.N()}finally{L()}}}});function N(t,i){return new h(t,i)}function oi(t){for(var i=t.s;i!==void 0;i=i.n)if(i.S.i!==i.i||!i.S.h()||i.S.i!==i.i)return!0;return!1}function ri(t){for(var i=t.s;i!==void 0;i=i.n){var e=i.S.n;if(e!==void 0&&(i.r=e),i.S.n=i,i.i=-1,i.n===void 0){t.s=i;break}}}function ui(t){for(var i=t.s,e=void 0;i!==void 0;){var n=i.p;i.i===-1?(i.S.U(i),n!==void 0&&(n.n=i.n),i.n!==void 0&&(i.n.p=n)):e=i,i.S.n=i.r,i.r!==void 0&&(i.r=void 0),i=n}t.s=e}function S(t,i){h.call(this,void 0),this.x=t,this.s=void 0,this.g=C-1,this.f=4,this.W=i?.watched,this.Z=i?.unwatched,this.name=i?.name}S.prototype=new h;S.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===C))return!0;if(this.g=C,this.f|=1,this.i>0&&!oi(this))return this.f&=-2,!0;var t=u;try{ri(this),u=this;var i=this.x();(16&this.f||this.v!==i||this.i===0)&&(this.v=i,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return u=t,ui(this),this.f&=-2,!0};S.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var i=this.s;i!==void 0;i=i.n)i.S.S(i)}h.prototype.S.call(this,t)};S.prototype.U=function(t){if(this.t!==void 0&&(h.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var i=this.s;i!==void 0;i=i.n)i.S.U(i)}};S.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};Object.defineProperty(S.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var t=ni(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Q(t,i){return new S(t,i)}function si(t){var i=t.u;if(t.u=void 0,typeof i=="function"){w++;var e=u;u=void 0;try{i()}catch(n){throw t.f&=-2,t.f|=8,V(t),n}finally{u=e,L()}}}function V(t){for(var i=t.s;i!==void 0;i=i.n)i.S.U(i);t.x=void 0,t.s=void 0,si(t)}function ki(t){if(u!==this)throw new Error("Out-of-order effect");ui(this),u=t,this.f&=-2,8&this.f&&V(this),L()}function E(t,i){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=i?.name}E.prototype.c=function(){var t=this.S();try{if(8&this.f||this.x===void 0)return;var i=this.x();typeof i=="function"&&(this.u=i)}finally{t()}};E.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,si(this),ri(this),w++;var t=u;return u=this,ki.bind(this,t)};E.prototype.N=function(){2&this.f||(this.f|=2,this.o=k,k=this)};E.prototype.d=function(){this.f|=8,1&this.f||V(this)};E.prototype.dispose=function(){this.d()};function A(t,i){var e=new E(t,i);try{e.c()}catch(o){throw e.d(),o}var n=e.d.bind(e);return n[Symbol.dispose]=n,n}var ci,I,fi=[];A(function(){ci=this.N})();function $(t,i){b[t]=i.bind(null,b[t]||function(){})}function U(t){I&&I(),I=t&&t.S()}function _i(t){var i=this,e=t.data,n=bi(e);n.value=e;var o=wi(function(){for(var c=i,a=i.__v;a=a.__;)if(a.__c){a.__c.__$f|=4;break}var l=Q(function(){var m=n.value.value;return m===0?0:m===!0?"":m||""}),y=Q(function(){return!Array.isArray(l.value)&&!X(l.value)}),O=A(function(){if(this.N=ai,y.value){var m=l.value;c.__v&&c.__v.__e&&c.__v.__e.nodeType===3&&(c.__v.__e.data=m)}}),p=i.__$u.d;return i.__$u.d=function(){O(),p.call(this)},[y,l]},[]),r=o[0],s=o[1];return r.value?s.peek():s.value}_i.displayName="ReactiveTextNode";Object.defineProperties(h.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:_i},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});$("__b",function(t,i){if(typeof i.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),typeof i.type=="string"){var e,n=i.props;for(var o in n)if(o!=="children"){var r=n[o];r instanceof h&&(e||(i.__np=e={}),e[o]=r,n[o]=r.peek())}}t(i)});$("__r",function(t,i){if(typeof i.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.enterComponent(i),i.type!==pi){U();var e,n=i.__c;n&&(n.__$f&=-2,(e=n.__$u)===void 0&&(n.__$u=e=(function(o){var r;return A(function(){r=this}),r.c=function(){n.__$f|=1,n.setState({})},r})())),U(e)}t(i)});$("__e",function(t,i,e,n){typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),U(),t(i,e,n)});$("diffed",function(t,i){typeof i.type=="function"&&typeof window<"u"&&window.__PREACT_SIGNALS_DEVTOOLS__&&window.__PREACT_SIGNALS_DEVTOOLS__.exitComponent(),U();var e;if(typeof i.type=="string"&&(e=i.__e)){var n=i.__np,o=i.props;if(n){var r=e.U;if(r)for(var s in r){var c=r[s];c!==void 0&&!(s in n)&&(c.d(),r[s]=void 0)}else r={},e.U=r;for(var a in n){var l=r[a],y=n[a];l===void 0?(l=Ni(e,a,y,o),r[a]=l):l.o(y,o)}}}t(i)});function Ni(t,i,e,n){var o=i in t&&t.ownerSVGElement===void 0,r=N(e);return{o:function(s,c){r.value=s,n=c},d:A(function(){this.N=ai;var s=r.value.value;n[i]!==s&&(n[i]=s,o?t[i]=s:s?t.setAttribute(i,s):t.removeAttribute(i))})}}$("unmount",function(t,i){if(typeof i.type=="string"){var e=i.__e;if(e){var n=e.U;if(n){e.U=void 0;for(var o in n){var r=n[o];r&&r.d()}}}}else{var s=i.__c;if(s){var c=s.__$u;c&&(s.__$u=void 0,c.d())}}t(i)});$("__h",function(t,i,e,n){(n<3||n===9)&&(i.__$f|=2),t(i,e,n)});function bi(t,i){return yi(function(){return N(t,i)})[0]}var Oi=function(t){queueMicrotask(function(){queueMicrotask(t)})};function xi(){$i(function(){for(var t;t=fi.shift();)ci.call(t)})}function ai(){fi.push(this)===1&&(b.requestAnimationFrame||Oi)(xi)}const li=document.getElementById("login"),P=document.getElementById("logout"),B=document.getElementById("userinfo"),D=document.getElementById("callapi"),Ti=document.getElementById("switch"),g={isAuthenticated:N(!1),isLoading:N(!1),userInfo:N(null)};async function Ci(){console.log("Checking SSO..."),console.log("Checking local cache...");const t=await d.getUser();if(t&&!t.expired)return console.log("Using cached user:",t),v("out","Using cached user: "+JSON.stringify(t,null,2)),!0;try{console.log("Trying silent signin...");const i=await d.signinSilent();return console.log("Silent signin success:",i),v("out","Silent signin success: "+JSON.stringify(i,null,2)),!!i&&!i.expired}catch{return!1}}async function Ui(){console.log("Bootstrapping auth..."),g.isLoading.value=!0;try{li.onclick=()=>d.signinRedirect(),Ti.onclick=()=>{const i=encodeURIComponent("/cpds/");window.location.href="/cpds/#switcher"};const t=await Ci();if(g.isAuthenticated.value=t,t)console.log("Authenticated."),v("out","Authenticated.");else if(console.log("Not authenticated."),v("out","Not authenticated."),window.location.hash.includes("switcher")){console.log("Switch detected, forcing login..."),await d.signinRedirect();return}d.events.addAccessTokenExpiring(async()=>{console.log("Access token expiring...");try{await d.signinSilent(),v("out","token expiring → silent renew"),v("out","silent renew success")}catch(i){v("out","silent renew error: "+i)}}),d.events.addAccessTokenExpired(async()=>{console.log("Access token expired");try{await d.signinSilent(),v("out","token expired → silent renew")}catch(i){v("out","silent renew error: "+i),g.isAuthenticated.value=!1}}),d.events.addUserSignedOut(async()=>{console.log("User signed out of SSO"),await d.removeUser(),g.isAuthenticated.value=!1})}catch(t){console.error(t),v("out","Init error: "+t),g.isAuthenticated.value=!1}finally{g.isLoading.value=!1}}A(()=>{const t=g.isAuthenticated.value;li.style.display=t?"none":"inline-block",P.style.display=t?"inline-block":"none",B.style.display=t?"inline-block":"none",D.style.display=t?"inline-block":"none",t&&(P.onclick||(P.onclick=async()=>{try{await d.signoutRedirect({post_logout_redirect_uri:`${window.location.origin}/aceas/`})}finally{await d.removeUser(),g.isAuthenticated.value=!1}}),B.onclick||(B.onclick=async()=>{const i=await d.getUser();if(!i)return v("out","Not logged in!");const n=await(await fetch("http://eservice.localhost/auth/realms/agency-realm/protocol/openid-connect/userinfo",{headers:{Authorization:`Bearer ${i.access_token}`}})).json();g.userInfo.value=n,v("out","userinfo: "+JSON.stringify(n,null,2))}),D.onclick||(D.onclick=async()=>{const i=await d.getUser();if(!i)return v("out","Login first");const e=await hi("/aceas/api/hello",i.access_token);v("out",`ACEAS API [${e.status}]:
${e.body}`)}))});A(()=>g.isLoading.value?vi():di());Ui();
