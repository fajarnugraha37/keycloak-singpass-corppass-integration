import"../modulepreload-polyfill-B5Qt9EMX.js";/* empty css                */import{l as c,c as ht,s as lt,h as vt}from"../sched-DruKi8Dd.js";import{o as h}from"../oidc-DAcC_2S7.js";var E,K;function dt(i){return i.children}E={__e:function(i,t,e,n){for(var o,s,u;t=t.__;)if((o=t.__c)&&!o.__)try{if((s=o.constructor)&&s.getDerivedStateFromError!=null&&(o.setState(s.getDerivedStateFromError(i)),u=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(i,n||{}),u=o.__d),u)return o.__E=o}catch(_){i=_}throw i}},K=function(i){return i!=null&&i.constructor==null},typeof Promise=="function"&&Promise.prototype.then.bind(Promise.resolve());var q,l,B,j,J=0,Q=[],a=E,D=a.__b,R=a.__r,z=a.diffed,W=a.__c,Z=a.unmount,M=a.__;function pt(i,t){a.__h&&a.__h(l,i,J||t),J=0;var e=l.__H||(l.__H={__:[],__h:[]});return i>=e.__.length&&e.__.push({}),e.__[i]}function X(i,t){var e=pt(q++,7);return mt(e.__H,t)&&(e.__=i(),e.__H=t,e.__h=i),e.__}function yt(){for(var i;i=Q.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(x),i.__H.__h.forEach(C),i.__H.__h=[]}catch(t){i.__H.__h=[],a.__e(t,i.__v)}}a.__b=function(i){l=null,D&&D(i)},a.__=function(i,t){i&&t.__k&&t.__k.__m&&(i.__m=t.__k.__m),M&&M(i,t)},a.__r=function(i){R&&R(i),q=0;var t=(l=i.__c).__H;t&&(B===l?(t.__h=[],l.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0})):(t.__h.forEach(x),t.__h.forEach(C),t.__h=[],q=0)),B=l},a.diffed=function(i){z&&z(i);var t=i.__c;t&&t.__H&&(t.__H.__h.length&&(Q.push(t)!==1&&j===a.requestAnimationFrame||((j=a.requestAnimationFrame)||gt)(yt)),t.__H.__.forEach(function(e){e.u&&(e.__H=e.u),e.u=void 0})),B=l=null},a.__c=function(i,t){t.some(function(e){try{e.__h.forEach(x),e.__h=e.__h.filter(function(n){return!n.__||C(n)})}catch(n){t.some(function(o){o.__h&&(o.__h=[])}),t=[],a.__e(n,e.__v)}}),W&&W(i,t)},a.unmount=function(i){Z&&Z(i);var t,e=i.__c;e&&e.__H&&(e.__H.__.forEach(function(n){try{x(n)}catch(o){t=o}}),e.__H=void 0,t&&a.__e(t,e.__v))};var G=typeof requestAnimationFrame=="function";function gt(i){var t,e=function(){clearTimeout(n),G&&cancelAnimationFrame(t),setTimeout(i)},n=setTimeout(e,35);G&&(t=requestAnimationFrame(e))}function x(i){var t=l,e=i.__c;typeof e=="function"&&(i.__c=void 0,e()),l=t}function C(i){var t=l;i.__c=i.__(),l=t}function mt(i,t){return!i||i.length!==t.length||t.some(function(e,n){return e!==i[n]})}var wt=Symbol.for("preact-signals");function H(){if(y>1)y--;else{for(var i,t=!1;b!==void 0;){var e=b;for(b=void 0,P++;e!==void 0;){var n=e.o;if(e.o=void 0,e.f&=-3,!(8&e.f)&&it(e))try{e.c()}catch(o){t||(i=o,t=!0)}e=n}}if(P=0,y--,t)throw i}}function St(i){if(y>0)return i();y++;try{return i()}finally{H()}}var r=void 0;function Y(i){var t=r;r=void 0;try{return i()}finally{r=t}}var b=void 0,y=0,P=0,N=0;function tt(i){if(r!==void 0){var t=i.n;if(t===void 0||t.t!==r)return t={i:0,S:i,p:r.s,n:void 0,t:r,e:void 0,x:void 0,r:t},r.s!==void 0&&(r.s.n=t),r.s=t,i.n=t,32&r.f&&i.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=r.s,t.n=void 0,r.s.n=t,r.s=t),t}}function f(i,t){this.v=i,this.i=0,this.n=void 0,this.t=void 0,this.W=t?.watched,this.Z=t?.unwatched}f.prototype.brand=wt;f.prototype.h=function(){return!0};f.prototype.S=function(i){var t=this,e=this.t;e!==i&&i.e===void 0&&(i.x=e,this.t=i,e!==void 0?e.e=i:Y(function(){var n;(n=t.W)==null||n.call(t)}))};f.prototype.U=function(i){var t=this;if(this.t!==void 0){var e=i.e,n=i.x;e!==void 0&&(e.x=n,i.e=void 0),n!==void 0&&(n.e=e,i.x=void 0),i===this.t&&(this.t=n,n===void 0&&Y(function(){var o;(o=t.Z)==null||o.call(t)}))}};f.prototype.subscribe=function(i){var t=this;return m(function(){var e=t.value,n=r;r=void 0;try{i(e)}finally{r=n}})};f.prototype.valueOf=function(){return this.value};f.prototype.toString=function(){return this.value+""};f.prototype.toJSON=function(){return this.value};f.prototype.peek=function(){var i=r;r=void 0;try{return this.value}finally{r=i}};Object.defineProperty(f.prototype,"value",{get:function(){var i=tt(this);return i!==void 0&&(i.i=this.i),this.v},set:function(i){if(i!==this.v){if(P>100)throw new Error("Cycle detected");this.v=i,this.i++,N++,y++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{H()}}}});function A(i,t){return new f(i,t)}function it(i){for(var t=i.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function et(i){for(var t=i.s;t!==void 0;t=t.n){var e=t.S.n;if(e!==void 0&&(t.r=e),t.S.n=t,t.i=-1,t.n===void 0){i.s=t;break}}}function nt(i){for(var t=i.s,e=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):e=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}i.s=e}function g(i,t){f.call(this,void 0),this.x=i,this.s=void 0,this.g=N-1,this.f=4,this.W=t?.watched,this.Z=t?.unwatched}g.prototype=new f;g.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===N))return!0;if(this.g=N,this.f|=1,this.i>0&&!it(this))return this.f&=-2,!0;var i=r;try{et(this),r=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return r=i,nt(this),this.f&=-2,!0};g.prototype.S=function(i){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}f.prototype.S.call(this,i)};g.prototype.U=function(i){if(this.t!==void 0&&(f.prototype.U.call(this,i),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};g.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var i=this.t;i!==void 0;i=i.x)i.t.N()}};Object.defineProperty(g.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var i=tt(this);if(this.h(),i!==void 0&&(i.i=this.i),16&this.f)throw this.v;return this.v}});function V(i,t){return new g(i,t)}function ot(i){var t=i.u;if(i.u=void 0,typeof t=="function"){y++;var e=r;r=void 0;try{t()}catch(n){throw i.f&=-2,i.f|=8,L(i),n}finally{r=e,H()}}}function L(i){for(var t=i.s;t!==void 0;t=t.n)t.S.U(t);i.x=void 0,i.s=void 0,ot(i)}function $t(i){if(r!==this)throw new Error("Out-of-order effect");nt(this),r=i,this.f&=-2,8&this.f&&L(this),H()}function w(i){this.x=i,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}w.prototype.c=function(){var i=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{i()}};w.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,ot(this),et(this),y++;var i=r;return r=this,$t.bind(this,i)};w.prototype.N=function(){2&this.f||(this.f|=2,this.o=b,b=this)};w.prototype.d=function(){this.f|=8,1&this.f||L(this)};w.prototype.dispose=function(){this.d()};function m(i){var t=new w(i);try{t.c()}catch(n){throw t.d(),n}var e=t.d.bind(t);return e[Symbol.dispose]=e,e}var rt,O,st=[];m(function(){rt=this.N})();function S(i,t){E[i]=t.bind(null,E[i]||function(){})}function U(i){O&&O(),O=i&&i.S()}function ut(i){var t=this,e=i.data,n=bt(e);n.value=e;var o=X(function(){for(var _=t,d=t.__v;d=d.__;)if(d.__c){d.__c.__$f|=4;break}var p=V(function(){var k=n.value.value;return k===0?0:k===!0?"":k||""}),$=V(function(){return!Array.isArray(p.value)&&!K(p.value)}),ct=m(function(){if(this.N=at,$.value){var k=p.value;_.__v&&_.__v.__e&&_.__v.__e.nodeType===3&&(_.__v.__e.data=k)}}),_t=t.__$u.d;return t.__$u.d=function(){ct(),_t.call(this)},[$,p]},[]),s=o[0],u=o[1];return s.value?u.peek():u.value}ut.displayName="_st";Object.defineProperties(f.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:ut},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});S("__b",function(i,t){if(typeof t.type=="string"){var e,n=t.props;for(var o in n)if(o!=="children"){var s=n[o];s instanceof f&&(e||(t.__np=e={}),e[o]=s,n[o]=s.peek())}}i(t)});S("__r",function(i,t){if(t.type!==dt){U();var e,n=t.__c;n&&(n.__$f&=-2,(e=n.__$u)===void 0&&(n.__$u=e=(function(o){var s;return m(function(){s=this}),s.c=function(){n.__$f|=1,n.setState({})},s})())),U(e)}i(t)});S("__e",function(i,t,e,n){U(),i(t,e,n)});S("diffed",function(i,t){U();var e;if(typeof t.type=="string"&&(e=t.__e)){var n=t.__np,o=t.props;if(n){var s=e.U;if(s)for(var u in s){var _=s[u];_!==void 0&&!(u in n)&&(_.d(),s[u]=void 0)}else s={},e.U=s;for(var d in n){var p=s[d],$=n[d];p===void 0?(p=kt(e,d,$,o),s[d]=p):p.o($,o)}}}i(t)});function kt(i,t,e,n){var o=t in i&&i.ownerSVGElement===void 0,s=A(e);return{o:function(u,_){s.value=u,n=_},d:m(function(){this.N=at;var u=s.value.value;n[t]!==u&&(n[t]=u,o?i[t]=u:u?i.setAttribute(t,u):i.removeAttribute(t))})}}S("unmount",function(i,t){if(typeof t.type=="string"){var e=t.__e;if(e){var n=e.U;if(n){e.U=void 0;for(var o in n){var s=n[o];s&&s.d()}}}}else{var u=t.__c;if(u){var _=u.__$u;_&&(u.__$u=void 0,_.d())}}i(t)});S("__h",function(i,t,e,n){(n<3||n===9)&&(t.__$f|=2),i(t,e,n)});function bt(i,t){return X(function(){return A(i,t)},[])}var At=function(i){queueMicrotask(function(){queueMicrotask(i)})};function Et(){St(function(){for(var i;i=st.shift();)rt.call(i)})}function at(){st.push(this)===1&&(E.requestAnimationFrame||At)(Et)}const ft=document.getElementById("login"),I=document.getElementById("logout"),F=document.getElementById("userinfo"),T=document.getElementById("callapi"),xt=document.getElementById("switch"),v={isAuthenticated:A(!1),isLoading:A(!1),userInfo:A(null)};async function Nt(){const i=await h.getUser();if(i&&!i.expired)return c("out","Using cached user: "+JSON.stringify(i,null,2)),!0;try{const t=await h.signinSilent();return c("out","Silent signin success: "+JSON.stringify(t,null,2)),!!t&&!t.expired}catch{return!1}}async function Ut(){v.isLoading.value=!0;try{ft.onclick=()=>h.signinRedirect(),xt.onclick=()=>{const t=encodeURIComponent("/cpds/");window.location.href="/cpds/#switcher"};const i=await Nt();if(v.isAuthenticated.value=i,i)c("out","Authenticated.");else if(c("out","Not authenticated."),window.location.hash.includes("switcher")){await h.signinRedirect();return}h.events.addAccessTokenExpiring(async()=>{try{await h.signinSilent(),c("out","token expiring â†’ silent renew"),c("out","silent renew success")}catch(t){c("out","silent renew error: "+t)}}),h.events.addAccessTokenExpired(async()=>{try{await h.signinSilent(),c("out","token expired â†’ silent renew")}catch(t){c("out","silent renew error: "+t),v.isAuthenticated.value=!1}}),h.events.addUserSignedOut(async()=>{await h.removeUser(),v.isAuthenticated.value=!1})}catch(i){console.error(i),c("out","Init error: "+i),v.isAuthenticated.value=!1}finally{v.isLoading.value=!1}}m(()=>{const i=v.isAuthenticated.value;ft.style.display=i?"none":"inline-block",I.style.display=i?"inline-block":"none",F.style.display=i?"inline-block":"none",T.style.display=i?"inline-block":"none",i&&(I.onclick||(I.onclick=async()=>{try{await h.signoutRedirect({post_logout_redirect_uri:`${window.location.origin}/aceas/`})}finally{await h.removeUser(),v.isAuthenticated.value=!1}}),F.onclick||(F.onclick=async()=>{const t=await h.getUser();if(!t)return c("out","Not logged in!");const n=await(await fetch("http://eservice.localhost/auth/realms/agency-realm/protocol/openid-connect/userinfo",{headers:{Authorization:`Bearer ${t.access_token}`}})).json();v.userInfo.value=n,c("out","userinfo: "+JSON.stringify(n,null,2));const o=await fetch("http://eservice.localhost/auth/realms/agency-realm/demo/ping",{headers:{Authorization:`Bearer ${t.access_token}`}});c("out","ping: "+JSON.stringify(await o.json(),null,2))}),T.onclick||(T.onclick=async()=>{const t=await h.getUser();if(!t)return c("out","Login first");const e=await ht("/aceas/api/hello",t.access_token);c("out",`ACEAS API [${e.status}]:
${e.body}`)}))});m(()=>v.isLoading.value?lt():vt());Ut();
