server_tokens off;

proxy_hide_header 'X-Powered-By';
proxy_hide_header 'Vary';

# Allow requests from any or specific origin
add_header 'Access-Control-Allow-Origin' '*' always;
# Allowed HTTP methods for cross-origin requests
add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
# Allowed custom headers (Authorization, Content-Type, etc.)
add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,Accept' always;
add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
add_header 'X-Powered-By' 'God' always;

# added
sub_filter_once on;
sub_filter_last_modified on;
sub_filter_types text/html;   # <-- crucial: do NOT include css/js here


# Increase header buffer sizes to accept larger cookies/headers
large_client_header_buffers 8 32k;
client_header_buffer_size 32k;
proxy_buffer_size 64k;
proxy_buffers 8 64k;
proxy_busy_buffers_size 128k;

gzip on;
gzip_disable "msie6";
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_buffers 16 8k;
gzip_http_version 1.0;
gzip_min_length 256;
gzip_types
  application/atom+xml
  application/geo+json
  application/javascript
  application/x-javascript
  application/json
  application/ld+json
  application/manifest+json
  application/rdf+xml
  application/rss+xml
  application/xhtml+xml
  application/xml
  font/eot
  font/otf
  font/ttf
  image/svg+xml
  text/css
  text/javascript
  text/plain
  text/xml;

if ($request_method = 'OPTIONS') {
    return 204;
}

location /health {
    access_log off;
    return 200 'healthy\n';
}